---
title: "Step4"
author: "Zohreh Sharafian"
date: "March 24, 2018"
output: html_document
---

```{r setup, include=FALSE}
library(pheatmap)
library(reshape2)
library(tidyverse)
library(GEOquery)
library(RColorBrewer)
library(cluster)
library(pvclust)
library(xtable)
library(limma)
library(dplyr)
library(lattice)
library(RCurl)
library(GEOquery)
library(knitr)
library(reshape2)#
library(purrr)
library(corrplot) # We'll use corrplot later on in this example too.
#library(rgl)#3D plot not working yet
#library(scatterplot3d)#3D plot not working yet
#library(visreg)


library(Hmisc)
library(psych)
library(MASS)
library(DAAG)
```

```{r}
RosmapData <- load("C:/Users/zohre/Desktop/Repo_team_Gene_Heroes/Data/rosmap_postprocV2.RData")
probes_subjects[1:5, 1:5]
subjects_genes[1:5,1:5]
str(RosmapData)
```
```{r}
nrow(probes_genes_distance) #number of probes
ncol(probes_genes_distance) #number of genes
```


```{r}
cor_test_results_PCA_lapply_V2 <- readRDS("C:/Users/zohre/Desktop/Repo_team_Gene_Heroes/cor_test_results_PCA_lapply_V2.rds")
head (cor_test_results_PCA_lapply_V2)

hist(cor_test_results_PCA_lapply_V2$adjusted.pvalue[cor_test_results_PCA_lapply_V2$adjusted.pvalue<0.05])
```

```{r}
extracted_matrix <- cor_test_results_PCA_lapply_V2 [,c(1,2, 5)]
head(extracted_matrix)
nrow(extracted_matrix)

filtered_pvalue <- extracted_matrix[extracted_matrix$adjusted.pvalue<0.05,]
nrow(filtered_pvalue)
```

```{r}
data <- as.data.frame(as.matrix(probes_genes_distance))
colnames(data) <- names(subjects_genes)
rownames(data) <- rownames(probes_subjects)

#list1$test1value <- list2$test[match(list1$id, list2$id)]

x <- match(filtered_pvalue$probe, rownames(data) )
y <- match(filtered_pvalue$gene, colnames(data) )
inds=cbind(x,y)
x2 <- data[inds]
rrrr=hist(x2)

#melt_x2 <- melt(rownames_to_column(data, var="probe"), id="probe")
#head(melt_x2)

#ggplot() + aes(x2)+ geom_histogram(binwidth=1, colour="black", fill="white")



#new_Data <- left_join(filtered_pvalue, melt_x2, by= c("probe"="probe", "gene"="variable"))
head(x2)
dim(data)
dim(filtered_pvalue)
summary(x)
class(filtered_pvalue)
```



# graph No.2 the average of pValue vs the distance of probes
```{r}
tmp <- hist(x2)
intervals_values=findInterval(x2,tmp$breaks)


```


```{r}

histog <-  integer (10)
for(i in 1:10) {
elemenets_in_this_interval <-which(intervals_values==i);
histog[i]=mean(filtered_pvalue$adjusted.pvalue[elemenets_in_this_interval])
print((histog[i]))
}
x=tmp$mids;
y=histog;
data=cbind(x,y)
data=as.data.frame(data)
colnames(data)=c("x_val","y_val")
data %>% ggplot2::ggplot(aes(x=x_val,y=y_val)) +geom_line()

```

```{r}
#p<-ggplot(data=hist.data.frame(tmp), aes(x=tmp$mids, y=tmp$counts)) +
  
  #geom_bar(stat="identity")

```

































```{r}
#gene1 <- cor_test_results_PCA_lapply_V2 %>%  filter(gene=="RAB4B:ENSG00000167578.11")
#gene1
#gene1.sorted<- gene1[order(gene1$pvalue),]

#head(gene1.sorted)

#gene1_ros <- RosmapData %>%  filter(gene=="RAB4B:ENSG00000167578.11")
```

